<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Greek House Tapper</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body, html, * {
  user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  -moz-user-select: none;
}

    /* –°—Ç–∏–ª—å –¥–ª—è –º–æ–Ω–µ—Ç–∫–∏, —â–æ –ª–µ—Ç–∏—Ç—å */
.coin-fly {
  position: fixed;
  width: 24px;
  height: 24px;
  background-image: url("greenCoin.png"); /* –ó–∞–º—ñ–Ω–∏ –Ω–∞ —Å–≤–æ—é –º–æ–Ω–µ—Ç—É, –∞–±–æ goldCoin.png */
  background-size: contain;
  background-repeat: no-repeat;
  pointer-events: none;
  z-index: 9999;
  animation: flyToCounter 1s ease-out forwards;
}

/* –ê–Ω—ñ–º–∞—Ü—ñ—è ‚Äì –ª–µ—Ç–∏—Ç—å –¥–æ —Ü–µ–Ω—Ç—Ä—É –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ */
@keyframes flyToCounter {
  to {
    transform: translate(var(--dx), var(--dy)) scale(0.3);
    opacity: 0;
  }
}

.section-heading {
  position: relative;
  padding: 12px 20px;
  border-radius: 20px;
  display: inline-block;
  margin-bottom: 8px;
  font-weight: bold;
  color: #003300;
  z-index: 1;
  background: linear-gradient(
    145deg,
    rgba(202, 255, 179, 0.85) 40%,
    rgba(202, 255, 179, 0.3) 80%,
    rgba(202, 255, 179, 0.0) 100%
  );
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.06);
/*   backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px); */
  overflow: hidden;
}

.section-heading::before {
  content: "";
  position: absolute;
  top: -30%;
  left: -30%;
  width: 160%;
  height: 160%;
  background: conic-gradient(
    from 90deg,
    rgba(202, 255, 179, 0.12),
    rgba(202, 255, 179, 0.05),
    rgba(202, 255, 179, 0.1),
    rgba(202, 255, 179, 0.02),
    transparent,
    rgba(202, 255, 179, 0.08)
  );
  opacity: 0.7;
  z-index: -1;
  pointer-events: none;
  mix-blend-mode: soft-light;
  border-radius: 50%;
/*   filter: blur(8px); */
}


.tap-coin {
  width: 145px;
  height: 145px;
  border-radius: 50%;
  margin: 16px auto 8px;
  cursor: pointer;
  overflow: hidden;
  transition: transform 0.1s;
  display: block; /* üëà –∑–º—ñ–Ω–µ–Ω–æ */
  background-color: transparent;
  padding: 0;
  border: none;
  transition: transform 0.15s ease;
    -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}
    .tap-coin.rotated {
  transform: rotate(-5deg);
}

.tap-coin img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover; /* üëà —Ü–µ –æ–∫ */
  border-radius: 50%;
}

.tap-coin.active {
  transform: scale(1.05);
  filter: brightness(1.1);
}

.plus-one {
  position: absolute;
   color: white; /* üëà –±—É–ª–æ #2e7d32 */
  text-shadow: 0 0 6px rgba(0,0,0,0.4); /* üëà –ª–µ–≥–∫–µ —Å—è–π–≤–æ */
  font-size: 24px;
  font-weight: bold;
  animation: floatUp 0.8s ease forwards;
  pointer-events: none;
  z-index: 999;
  filter: drop-shadow(0 0 4px #000);
}

@keyframes floatUp {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-40px);
  }
}

    :root {
      --main-green: #004d00;
      --accent-green: #43a047;
      --light-green: #66bb6a;
      --dark-green: #2e7d32;
      --card-bg: #f5f5f5;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      background: linear-gradient(to bottom, var(--main-green), #ffffff);
      animation: fadeIn 1s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .tab-content {
      flex: 1;
      padding: 20px;
      display: none;
      text-align: center;
      overflow-y: auto;
      animation: slideIn 0.3s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .tab-bar {
      display: flex;
      height: 60px;
      background: var(--main-green);
      border-top: 2px solid var(--dark-green);
      box-shadow: 0 -3px 10px rgba(0,0,0,0.2);
    }

    .tab-button {
      flex: 1;
      font-size: 18px;
      padding: 10px;
      cursor: pointer;
      border: none;
      background: none;
      color: white;
      font-weight: bold;
      transition: background 0.3s;
    }

    .tab-button:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .tab-button.active {
      background: var(--light-green);
      color: #fff;
    }

    .counter {
      margin-top: 20px;
      font-size: 24px;
      color: #000000;
      animation: pulse 1s infinite alternate ease-in-out;
    }

    @keyframes pulse {
      from { transform: scale(1); }
      to { transform: scale(1.05); }
    }

    .logo {
      width: 100px;
      margin: 10px auto;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .gyros-img, .bonus-img {
      max-width: 100%;
      margin-top: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .bonus-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .bonus-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      text-align: left;
      transition: transform 0.2s;
    }

    .bonus-card:hover {
      transform: scale(1.02);
    }

    .bonus-card img {
      width: 100%;
      border-radius: 12px;
      margin-bottom: 12px;
    }

    .bonus-title {
      font-size: 20px;
      font-weight: bold;
      color: var(--dark-green);
      margin-bottom: 8px;
    }

    .bonus-description {
      font-size: 16px;
      margin-bottom: 12px;
      color: #333;
    }

    .bonus-price {
      font-size: 18px;
      color: #000;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .bonus-card button {
      padding: 12px 20px;
      background-color: var(--accent-green);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.1s;
    }

    .bonus-card button:hover {
      background-color: var(--light-green);
    }

    .bonus-card button:active {
      transform: scale(0.96);
    }

#happyHourTimer {
  max-width: 330px; /* –∞–±–æ 280px, —è–∫ –∑—Ä—É—á–Ω—ñ—à–µ */
  margin: 10px auto;
  text-align: center;
  padding: 6px 12px;
  border-radius: 16px;
  background: rgba(202, 255, 179, 0.35); /* –ø—Ä–æ–∑–æ—Ä–æ-–∑–µ–ª–µ–Ω–∞ –ø—ñ–¥–∫–ª–∞–¥–∫–∞ */
  backdrop-filter: blur(6px);
  font-weight: 600;
  font-size: 14px;
  line-height: 1.4;
  overflow: hidden;
}


    .bonus-card.used {
      opacity: 0.6;
      filter: grayscale(60%);
    }

    #confirmModal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 999;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
    }

#confirmModal::before {
  content: "";
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
/*   backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px); */
  background: rgba(255, 255, 255, 0.05); /* –ª–µ–≥–∫–∏–π –±—ñ–ª–∏–π –¥–∏–º–æ–∫ */
  z-index: -1;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.4s ease;
}

    
    #confirmModal .modal-box {
      background: white;
      padding: 24px;
      border-radius: 16px;
      max-width: 90%;
      text-align: center;
      box-shadow: 0 6px 18px rgba(0,0,0,0.3);
      animation: slideIn 0.4s ease;
    }

#confirmModal.active::before {
  opacity: 1;
  visibility: visible;
}

    
    #confirmModal p {
      font-size: 18px;
      color: #333;
    }

    #confirmModal button {
      padding: 12px 24px;
      margin: 10px 8px 0;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
    }

    #confirmActivate {
      background: var(--accent-green);
      color: white;
    }

    #cancelActivate {
      background: #ccc;
      color: #333;
    }
    .welcome-block {
  display: flex;
  flex-direction: column;
  align-items: center;
}
    #dailyRewardModal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.4);
  z-index: 999;
  justify-content: center;
  align-items: center;
/*   backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px); */
}

.daily-reward-box {
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.25);
  padding: 32px 24px;
  border-radius: 20px;
  max-width: 90%;
  text-align: center;
  color: white;
  box-shadow: 0 8px 24px rgba(0,0,0,0.25);
/*   backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px); */
  background-image: radial-gradient(circle at top left, rgba(202,255,179,0.3), rgba(255,255,255,0.05));
  animation: fadeInModal 0.3s ease-out;
}

@keyframes fadeInModal {
  from {
    transform: scale(0.95);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.daily-reward-box h3 {
  font-size: 22px;
  margin-bottom: 10px;
  color: #eaffea;
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.daily-reward-box p {
  font-size: 18px;
  color: #ffffff;
  margin-bottom: 20px;
  text-shadow: 0 1px 1px rgba(0,0,0,0.25);
}

.daily-reward-box button {
  padding: 10px 24px;
  background: linear-gradient(to right, #66bb6a, #99d699);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.daily-reward-box button:hover {
  background: linear-gradient(to right, #7ddc7d, #b4e8b4);
}
/* #blurOverlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  z-index: 998;
backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  opacity: 0; 
  transition: opacity 0.4s ease;
  pointer-events: none;
} */
#dailyRewardBlur {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 998;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  background: rgba(255, 255, 255, 0.05); /* –º‚Äô—è–∫–∏–π –¥–∏–º–æ–∫ */
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}
#dailyRewardBlur.active {
  opacity: 1;
  pointer-events: auto;
}
.fortune-btn {
  position: fixed;
  top: 32px;   /* üëà –±—ñ–ª—å—à–µ –≤—ñ–¥—Å—Ç—É–ø—É –∑–≤–µ—Ä—Ö—É */
  right: 28px; /* üëà –±—ñ–ª—å—à–µ –≤—ñ–¥—Å—Ç—É–ø—É —Å–ø—Ä–∞–≤–∞ */
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #000000 60%, #1E1E1E 100%);
  border: none;
  border-radius: 50%;
  box-shadow: 0 2px 18px 2px #ffe06655;
  padding: 14px; /* üëà –±—ñ–ª—å—à–µ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –≤—ñ–¥—Å—Ç—É–ø—É */
  cursor: pointer;
  outline: none;
  transition: box-shadow .2s, transform .12s;
}
.fortune-btn:hover {
  box-shadow: 0 2px 26px 8px #ffe06677;
  transform: scale(1.10);
}
.fortune-btn img {
  width: 72px;  /* üëà –≤–µ–ª–∏–∫–∞ —ñ–∫–æ–Ω–∫–∞! */
  height: 72px;
  pointer-events: none;
}
@media (max-width: 600px) {
  .fortune-btn { 
    top: 14px;
    right: 12px;
    padding: 7px;
  }
  .fortune-btn img { 
    width: 44px; height: 44px; 
  }
}
.fortune-modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  z-index: 2000;
  justify-content: center;
  align-items: center;
  /* –ú—ñ–Ω—ñ–º–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π –Ω–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä–∏–π –±—ñ–ª–∏–π —Ñ–æ–Ω –∑ –±–ª—é—Ä–æ–º */
  background: rgba(96, 96, 96, 0.10);
  backdrop-filter: blur(11px);
  -webkit-backdrop-filter: blur(11px);
  animation: fadeInModalBg .33s;
}
@keyframes fadeInModalBg {
  from { opacity: 0; }
  to   { opacity: 1; }
}


.fortune-modal-content {
  position: relative;
  background: rgba(255, 255, 255, 0.78);
  border-radius: 28px;
  padding: 36px 24px 24px 24px;
  min-width: 310px;
  max-width: 95vw;
  max-height: 90dvh;
  box-shadow: 0 6px 32px 0 #00884a28, 0 2px 18px #0002;
  text-align: center;
  animation: fortuneAppear 0.22s cubic-bezier(.18,.78,.61,1.09);
  backdrop-filter: blur(0.1px); /* –¢—Ä–æ—Ö–∏ –º º—è–∫—à–µ –≤–º—ñ—Å—Ç */
  -webkit-backdrop-filter: blur(0.1px);
  border: 1.5px solid #d3ffe2;
  display: flex;
  flex-direction: column;
   overflow: hidden;
}

@keyframes fortuneAppear {
  from { transform: scale(0.97) translateY(28px); opacity: 0;}
  to   { transform: scale(1) translateY(0); opacity: 1;}
}

.fortune-close-btn {
  position: absolute;
  top: 14px;
  right: 18px;
  background: rgba(44, 197, 125, 0.12);
  border: none;
  font-size: 26px;
  font-weight: 900;
  color: #12ae62;
  cursor: pointer;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  box-shadow: 0 4px 12px #0fc59013;
  transition: background .16s, color .18s;
  z-index: 2;
  display: flex; align-items: center; justify-content: center;
}
.fortune-close-btn:hover {
  background: #e33636; 
  color: #fff;
}
/* ===== Mini Caf√© ===== */
.mini-cafe { display:flex; flex-direction:column; gap:12px; align-items:center;   overflow: auto; padding-bottom: 12px; flex:1 1 auto;  -webkit-overflow-scrolling:touch;  padding:12px; }
.mini-cafe .order { font-weight:700; color:#0c6a3a; background:#eaffea; border:1px solid #c8f5d9; padding:8px 12px; border-radius:12px; }
.mini-cafe .worktop { display:flex; gap:12px; align-items:flex-end; justify-content:center; }
.ingredients {
  display:grid;
  grid-template-columns:repeat(4,minmax(62px,1fr));
  gap:10px;
}
.ingredient { background:#fff; border:1px solid #e3f7ea; border-radius:12px; padding:8px; cursor:pointer; box-shadow:0 2px 8px #0001; transition:transform .12s; font-size:12px; }
.ingredient:hover { transform:translateY(-1px); }
.ingredient.used { opacity:.45; pointer-events:none; }
.ingredient img { width:48px; height:48px; object-fit:cover; border-radius:10px; display:block; margin:0 auto 6px; }

.plate-wrap {
  position:relative;
  width: 250px;
  height: 160px;
}
.plate {
  position:absolute;
  left:0; right:0; bottom:0;
  margin:auto;
  width: 250px;
  height: 90px;
  background: radial-gradient(ellipse at center, #fff 60%, #eee 100%);
  border: 1px solid #e5e5e5;
  border-radius: 0 0 120px 120px;
  box-shadow: 0 6px 16px #0002 inset;
}
    .on-plate {
  position:absolute;
  left:50%;
  bottom:35px;
  transform:translateX(-50%);
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:center;
  width: 210px;
}

.badge-tip { font-size:12px; color:#3a3a3a; opacity:.8; }

.fly {
  position:fixed; z-index:3000; width:48px; height:48px; pointer-events:none;
  transition: transform .45s cubic-bezier(.2,.8,.2,1), opacity .45s;
}
.success-msg { color:#0d8a54; font-weight:700; margin-top:6px; }
.err-msg { color:#b00020; font-weight:600; margin-top:6px; }

@media (max-width: 600px) {
  .mini-cafe .worktop {
    flex-direction: column;
    align-items: center;
  }
  .ingredients {
    grid-template-columns:repeat(2, minmax(80px,1fr));
    gap:14px;
  }
  .plate-wrap {
    width: 200px;
    height: 140px;
  }
  .plate {
    width: 200px;
    height: 80px;
    border-radius: 0 0 100px 100px;
  }
  .on-plate {
    width: 170px;
    bottom: 30px;
  }
}
.mc-footer {
  bottom: 0;
  display: flex;
  flex:0 0 auto;  
  position:static;   
  gap: 8px;
  justify-content: center;
  background: rgba(255,255,255,0.92);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  padding: 10px 12px;
    padding-bottom:calc(10px + env(safe-area-inset-bottom));
  border-top: 1px solid #e8f5ee;
  border-radius: 0 0 24px 24px; /* —â–æ–± –∑–ª–∏–≤–∞–ª–æ—Å—è –∑ —Ä–∞–¥—ñ—É—Å–∞–º–∏ –º–æ–¥–∞–ª–∫–∏ */
  z-index: 1;
}

.mc-btn {
  padding: 10px 16px;
  border: none;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
}
#mcReset { background:#66bb6a; color:#fff; }
#mcClose { background:#e3e3e3; color:#333; }
    @media (max-width: 380px){
  .ingredients{
    grid-template-columns:repeat(2, minmax(72px,1fr));
    gap:12px;
  }
  .ingredient img{ width:44px; height:44px; }
}
  </style>
</head>
<body>
<!-- <div id="blurOverlay"></div> -->
<div id="dailyRewardBlur"></div>

  <!-- –¢–∞–ø–∞—Ç–∏ -->
  <div id="tap-tab" class="tab-content active">
    <button id="fortuneBtn" class="fortune-btn" title="–ú—ñ–Ω—ñ-–∫–∞—Ñ–µ">
<!--   <img src="fortuneWheelIcon.png" alt="–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω–∏"> -->
</button>

<div class="welcome-block">
    <img src="logo.jfif" alt="Greek House logo" class="logo">
  <h2 class="section-heading">–ü—Ä–∏–≤—ñ—Ç, <span id="username">...</span>!</h2>
</div>
        <div class="counter" id="counter">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    <div id="happyHourTimer" style="margin-top: 10px; font-size: 18px; color: #fff; background: #66bb6a; padding: 8px 16px; border-radius: 12px; display: none;">
  ‚è≥ Happy Hour —á–µ—Ä–µ–∑ ...
</div>
    <button class="tap-coin" id="tapBtn"><img src="greenCoin.png" alt="–ú–æ–Ω–µ—Ç–∫–∞ Greek House"></button>
    <img src="bg.jpg" alt="Gyros" class="gyros-img">
  </div>

 <!-- –†–∏–Ω–æ–∫ -->
<div id="market-tab" class="tab-content">
  <h2 class="section-heading">üõí –†–∏–Ω–æ–∫ –±–æ–Ω—É—Å—ñ–≤</h2>
  <div class="bonus-list">
    <div class="bonus-card">
      <img src="gyros.jpeg" alt="–ó–Ω–∏–∂–∫–∞ –Ω–∞ –≥—ñ—Ä–æ—Å">
      <div class="bonus-title">-50% –Ω–∞ –≥—ñ—Ä–æ—Å</div>
      <div class="bonus-description">–°–º–∞—á–Ω–∞ –∑–Ω–∏–∂–∫–∞ –Ω–∞ –≥—ñ—Ä–æ—Å —É Greek House</div>
      <div class="bonus-price">1000 –∫–ª—ñ–∫—ñ–≤</div>
      <button>–û—Ç—Ä–∏–º–∞—Ç–∏</button>
    </div>

    <div class="bonus-card">
      <img src="kartoplafrivelyka.jpeg" alt="–í–µ–ª–∏–∫–∞ –∫–∞—Ä—Ç–æ–ø–ª—è –∑–∞ 35 –≥—Ä–Ω">
      <div class="bonus-title">–í–µ–ª–∏–∫–∞ –∫–∞—Ä—Ç–æ–ø–ª—è –∑–∞ 35 –≥—Ä–Ω</div>
      <div class="bonus-description">–û–±–º—ñ–Ω—è–π –∫–ª—ñ–∫–∏ –Ω–∞ —Ö—Ä—É—Å—Ç–∫—É –∫–∞—Ä—Ç–æ–ø–ª—é!</div>
      <div class="bonus-price">700 –∫–ª—ñ–∫—ñ–≤</div>
      <button>–û—Ç—Ä–∏–º–∞—Ç–∏</button>
    </div>

    <div class="bonus-card">
      <img src="pitagrylichederini.png" alt="–ó–Ω–∏–∂–∫–∞ –Ω–∞ –ø—ñ—Ç—É –≥—Ä–∏–ª—å –∑ —á–µ–¥–µ—Ä–æ–º">
      <div class="bonus-title">-50% –Ω–∞ –ø—ñ—Ç—É –≥—Ä–∏–ª—å –∑ —á–µ–¥–µ—Ä–æ–º</div>
      <div class="bonus-description">–°–∫—É—à—Ç—É–π —É–ª—é–±–ª–µ–Ω—É –ø—ñ—Ç—É –≤ 2 —Ä–∞–∑–∏ –¥–µ—à–µ–≤—à–µ!</div>
      <div class="bonus-price">750 –∫–ª—ñ–∫—ñ–≤</div>
      <button>–û—Ç—Ä–∏–º–∞—Ç–∏</button>
    </div>
  </div>
</div>


  <!-- –Ü–Ω–≤–µ–Ω—Ç–∞—Ä -->
  <div id="inventory-tab" class="tab-content">
    <h2 class="section-heading">üéí –Ü–Ω–≤–µ–Ω—Ç–∞—Ä</h2>
    <div class="bonus-list"></div>
  </div>

  <!-- –ü–∞–Ω–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ -->
  <div class="tab-bar">
    <button class="tab-button active" onclick="showTab('tap-tab', this)">–¢–∞–ø–∞—Ç–∏</button>
    <button class="tab-button" onclick="showTab('market-tab', this)">–†–∏–Ω–æ–∫</button>
    <button class="tab-button" onclick="showTab('inventory-tab', this)">–Ü–Ω–≤–µ–Ω—Ç–∞—Ä</button>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ -->
  <div id="confirmModal">
    <div class="modal-box">
      <p>–ü—ñ—Å–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —Ü—å–æ–≥–æ –±–æ–Ω—É—Å—É –∑ º—è–≤–∏—Ç—å—Å—è –∫–æ–¥. –¶–µ–π –∫–æ–¥ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –∑–∞—Å–∫—Ä—ñ–Ω–∏—Ç–∏ –∞–±–æ –≤—ñ–¥—Ä–∞–∑—É –ø–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞ –∫–∞—Å—ñ. –Ü–Ω–∞–∫—à–µ, –≤–∏ –≤—Ç—Ä–∞—Ç–∏—Ç–µ —Ü–µ–π –∫–æ–¥ –Ω–∞–∑–∞–≤–∂–¥–∏.</p>
      <button id="confirmActivate">–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏</button>
      <button id="cancelActivate">–ù–∞–∑–∞–¥</button>
    </div>
  </div>
  
<div id="dailyRewardModal">
  <div class="daily-reward-box">
    <h3>üéâ –©–æ–¥–µ–Ω–Ω–∞ –Ω–∞–≥–æ—Ä–æ–¥–∞</h3>
    <p>+100 –∫–ª—ñ–∫—ñ–≤ –∑–∞ –≤—Ö—ñ–¥ —Å—å–æ–≥–æ–¥–Ω—ñ!</p>
    <button onclick="closeDailyRewardModal()">–û–∫–µ–π</button>
  </div>
</div>
  <div id="fortuneModal" class="fortune-modal">
  <div class="fortune-modal-content">
<button id="closeFortuneModal" class="fortune-close-btn" title="–ó–∞–∫—Ä–∏—Ç–∏">‚úï</button>
<h3>–ú—ñ–Ω—ñ-–∫–∞—Ñ–µ: –∑–±–µ—Ä—ñ—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>

<div id="miniCafe" class="mini-cafe">
  <div class="order" id="mcOrder">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è: –ì—ñ—Ä–æ—Å –∫–ª–∞—Å–∏—á–Ω–∏–π</div>

  <div class="worktop">
    <div class="ingredients" id="mcIngredients"></div>
    <div class="plate-wrap">
      <div class="plate"></div>
      <div class="on-plate" id="mcPlate"></div>
    </div>
  </div>

  <div class="badge-tip">–¢–∏—Ü—è–π —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ —É –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É üòâ</div>
  <div id="mcMsg"></div>
  </div>
  <div class="mc-footer">
  <button id="mcReset" class="mc-btn">–°–∫–∏–Ω—É—Ç–∏</button>
  <button id="mcClose" class="mc-btn">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div>

</div>

  </div>
</div>
<script>
  
  const tg = window.Telegram.WebApp;
  tg.expand();

  const supabaseUrl = 'https://mftgqxilushpzewpqkvi.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1mdGdxeGlsdXNocHpld3Bxa3ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzMDQxMzMsImV4cCI6MjA2Njg4MDEzM30.qRsUDDHSFuP6hIQZwv0mVsfS-ZZDPPbDU5Zl55Hoezw';

  let user = tg.initDataUnsafe?.user || { id: 123456789, first_name: "–¢–µ—Å—Ç" };
  const userId = user.id;
  const userName = user.first_name || "–ì—ñ—Å—Ç—å";
  document.getElementById("username").innerText = userName;

  const counterEl = document.getElementById("counter");
  const inventoryListEl = document.querySelector("#inventory-tab .bonus-list");

  const confirmModal = document.getElementById("confirmModal");

  const confirmBtn = document.getElementById("confirmActivate");
  const cancelBtn = document.getElementById("cancelActivate");
  let isHappyHour = false;

    const happyHourStart = 21; // 17:00
const happyHourEnd = 22;   // 18:00
  
  const availableBonuses = [
    {
      name: "gyros",
      title: "-50% –Ω–∞ –≥—ñ—Ä–æ—Å",
      description: "–°–º–∞—á–Ω–∞ –∑–Ω–∏–∂–∫–∞ –Ω–∞ –≥—ñ—Ä–æ—Å —É Greek House",
      price: 1000,
      image: "gyros.jpeg"
    },
    {
      name: "bigPotato",
      title: "–í–µ–ª–∏–∫–∞ –∫–∞—Ä—Ç–æ–ø–ª—è –∑–∞ 35 –≥—Ä–Ω",
      description: "–û–±–º—ñ–Ω—è–π –∫–ª—ñ–∫–∏ –Ω–∞ —Ö—Ä—É—Å—Ç–∫—É –∫–∞—Ä—Ç–æ–ø–ª—é!",
      price: 700,
      image: "kartoplafrivelyka.jpeg"
    },
    {
      name: "pitaGrylZChederom",
      title: "-50% –Ω–∞ –ø—ñ—Ç—É –≥—Ä–∏–ª—å –∑ —á–µ–¥–µ—Ä–æ–º",
      description: "–°–∫—É—à—Ç—É–π —É–ª—é–±–ª–µ–Ω—É –ø—ñ—Ç—É –≤ 2 —Ä–∞–∑–∏ –¥–µ—à–µ–≤—à–µ!",
      price: 750,
      image: "pitagrylichederini.png"
    }
  ];



  let clicks = 0;

const happyEl = document.getElementById("happyHourTimer");
// function showBlur() {
//   const blur = document.getElementById("blurOverlay");
//   blur.style.opacity = "1";
// }

// function hideBlur() {
//   const blur = document.getElementById("blurOverlay");
//   blur.style.opacity = "0";
// }


  
function updateHappyHourTimer() {
  const now = new Date();
  const currentHour = now.getHours();
  const currentMinutes = now.getMinutes();
  const currentSeconds = now.getSeconds();

  const tapImg = document.querySelector("#tapBtn img");
  const tapBtn = document.getElementById("tapBtn");
  tapBtn.classList.add("rotated");
  if (currentHour >= happyHourStart && currentHour < happyHourEnd) {
    const minutesLeft = 59 - currentMinutes;
    const secondsLeft = 59 - currentSeconds;
    happyEl.innerText = `üéâ Happy Hour! +2 –∫–ª—ñ–∫–∏! –ó–∞–ª–∏—à–∏–ª–æ—Å—å: ${minutesLeft} —Ö–≤ ${secondsLeft} —Å–µ–∫`;
    happyEl.style.display = "block";
    isHappyHour = true;

    // üü° –ó–æ–ª–æ—Ç–∞ –º–æ–Ω–µ—Ç–∫–∞ + –≤–∏–¥–∞–ª–∏—Ç–∏ –Ω–∞—Ö–∏–ª
    if (tapImg.src.includes("greenCoin.png")) {
      tapImg.src = "goldCoin.png";
    }
    tapBtn.classList.remove("rotated");

  } else {
    const nextHappy = new Date();
    nextHappy.setHours(happyHourStart, 0, 0, 0);
    if (now >= nextHappy) nextHappy.setDate(nextHappy.getDate() + 1);
    const diffMs = nextHappy - now;
  const totalSeconds = Math.floor(diffMs / 1000);
const hours = Math.floor(totalSeconds / 3600);
const minutes = Math.floor((totalSeconds % 3600) / 60);
const seconds = totalSeconds % 60;

if (hours > 0) {
  happyEl.innerText = `‚è≥ Happy Hour —á–µ—Ä–µ–∑: ${hours} –≥–æ–¥ ${minutes} —Ö–≤`;
} else if (minutes > 0) {
  happyEl.innerText = `‚è≥ Happy Hour —á–µ—Ä–µ–∑: ${minutes} —Ö–≤`;
} else {
  happyEl.innerText = `‚è≥ Happy Hour –≤–∂–µ –∑–æ–≤—Å—ñ–º —Å–∫–æ—Ä–æ!`;
}


    happyEl.style.display = "block";
    isHappyHour = false;

    // üü¢ –ó–µ–ª–µ–Ω–∞ –º–æ–Ω–µ—Ç–∫–∞ + –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –Ω–∞—Ö–∏–ª
    if (tapImg.src.includes("goldCoin.png")) {
      tapImg.src = "greenCoin.png";
    }
    tapBtn.classList.add("rotated");
  }
}

function animateCoinRain(count = 100, reward = 100) {
  const counter = document.getElementById("counter");
  const counterRect = counter.getBoundingClientRect();
  let added = 0;

  for (let i = 0; i < count && added < reward; i++) {
    setTimeout(() => {
      // 1. –ú–æ–Ω–µ—Ç–∫–∞ –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è
      const coin = document.createElement("div");
      coin.classList.add("coin-fly");

      const startX = window.innerWidth / 2 + (Math.random() * 80 - 40);
      const startY = window.innerHeight / 2 + (Math.random() * 80 - 40);
      coin.style.left = `${startX}px`;
      coin.style.top = `${startY}px`;

      const dx = counterRect.left + counterRect.width / 2 - startX;
      const dy = counterRect.top + counterRect.height / 2 - startY;
      coin.style.setProperty("--dx", `${dx}px`);
      coin.style.setProperty("--dy", `${dy}px`);

      document.body.appendChild(coin);

      // 2. –ó–±—ñ–ª—å—à—É—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫ –ü–û 1
      clicks++;
      added++;
      updateDisplay();

      // 3. –ó–±–µ—Ä—ñ–≥–∞—î–º–æ, –∫–æ–ª–∏ –≤—Å—ñ –¥–æ–¥–∞–ª–∏—Å—è
      if (added === reward) {
        saveUserData();
      }

      // 4. –ú–æ–Ω–µ—Ç–∫–∞ –∑–Ω–∏–∫–∞—î —á–µ—Ä–µ–∑ 900–º—Å (–∞–Ω—ñ–º–∫–∞)
      setTimeout(() => coin.remove(), 900);
    }, i * 15); // –∑–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ –º–æ–Ω–µ—Ç–∫–∞–º–∏ (–º–æ–∂–µ—à –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —à–≤–∏–¥—à–µ —á–∏ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ)
  }
}




setInterval(updateHappyHourTimer, 1000);

updateHappyHourTimer(); // –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –æ–¥—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ

const tapBtn = document.getElementById("tapBtn");

tapBtn.addEventListener("touchstart", () => {
  tapBtn.classList.add("active");
});
tapBtn.addEventListener("touchend", () => {
  tapBtn.classList.remove("active");
});
tapBtn.addEventListener("mousedown", () => {
  tapBtn.classList.add("active");
});
tapBtn.addEventListener("mouseup", () => {
  tapBtn.classList.remove("active");
});

async function checkDailyReward() {
  const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD

  const res = await fetch(`${supabaseUrl}/rest/v1/daily_rewards?user_id=eq.${userId}`, {
    headers: {
      apikey: supabaseKey,
      Authorization: `Bearer ${supabaseKey}`
    }
  });

  const data = await res.json();
  const lastRewardDate = data[0]?.last_claimed?.split('T')[0]; // –¢–µ–∂ –±–µ—Ä–µ–º–æ —Ç—ñ–ª—å–∫–∏ –¥–∞—Ç—É
  
  if (true) {
      // showBlur();
    // –î–æ–¥–∞—Ç–∏ +100 –∫–ª—ñ–∫—ñ–≤
    updateDisplay();
    await saveUserData();

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –º–æ–¥–∞–ª–∫—É
    document.getElementById("dailyRewardModal").style.display = "flex";
    document.getElementById("dailyRewardBlur").classList.add("active");

    if (data.length === 0) {
      // –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–ø–∏—Å
      await fetch(`${supabaseUrl}/rest/v1/daily_rewards`, {
        method: "POST",
        headers: {
          apikey: supabaseKey,
          Authorization: `Bearer ${supabaseKey}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ user_id: userId, last_claimed: today })
      });
    } else {
      // –û–Ω–æ–≤–∏—Ç–∏ –∑–∞–ø–∏—Å
      await fetch(`${supabaseUrl}/rest/v1/daily_rewards?user_id=eq.${userId}`, {
        method: "PATCH",
        headers: {
          apikey: supabaseKey,
          Authorization: `Bearer ${supabaseKey}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ last_claimed: today })
      });
    }
       // setTimeout(() => hideBlur(), 300);
  }
}


function closeDailyRewardModal() {
  document.getElementById("dailyRewardBlur").classList.remove("active");
  document.getElementById("dailyRewardModal").style.display = "none";

   animateCoinRain(100);
}

  async function fetchUserData() {
    const res = await fetch(`${supabaseUrl}/rest/v1/clicks?user_id=eq.${userId}`, {
      headers: { apikey: supabaseKey, Authorization: `Bearer ${supabaseKey}` }
    });
    const data = await res.json();
    if (data.length > 0) clicks = data[0].clicks;
    else {
      await fetch(`${supabaseUrl}/rest/v1/clicks`, {
        method: "POST",
        headers: {
          apikey: supabaseKey,
          Authorization: `Bearer ${supabaseKey}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ user_id: userId, clicks: 0 })
      });
    }
    updateDisplay();
    await checkDailyReward();
  }

  function updateDisplay() {
    counterEl.innerText = `–ö–ª—ñ–∫—ñ–≤: ${clicks}`;
  }

  async function saveUserData() {
    await fetch(`${supabaseUrl}/rest/v1/clicks?user_id=eq.${userId}`, {
      method: "PATCH",
      headers: {
        apikey: supabaseKey,
        Authorization: `Bearer ${supabaseKey}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ clicks })
    });
  }

  function generateRandomCode() {
    const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let code = 'GH-';
    for (let i = 0; i < 5; i++) {
      code += charset[Math.floor(Math.random() * charset.length)];
    }
    return code;
  }

  async function loadInventory() {
    const res = await fetch(`${supabaseUrl}/rest/v1/bonuses?user_id=eq.${userId}`, {
      headers: { apikey: supabaseKey, Authorization: `Bearer ${supabaseKey}` }
    });
    const bonuses = await res.json();

    bonuses.sort((a, b) => a.used - b.used); // –ì–æ—Ç–æ–≤—ñ —Å–ø–æ—á–∞—Ç–∫—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ ‚Äî –∑–Ω–∏–∑—É

    inventoryListEl.innerHTML = "";

    for (const bonus of bonuses) {
      const bonusData = availableBonuses.find(b => b.name === bonus.name);
      if (!bonusData) continue;

      const card = document.createElement("div");
      card.className = "bonus-card";
      if (bonus.used) card.classList.add("used");

      card.innerHTML = `
        <img src="${bonusData.image}" alt="${bonusData.title}">
        <div class="bonus-title">${bonusData.title}</div>
        <div class="bonus-description">${bonusData.description}</div>
        <div class="bonus-price">–°—Ç–∞—Ç—É—Å: <strong>${bonus.used ? "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ" : "–ì–æ—Ç–æ–≤–∏–π –¥–æ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó"}</strong></div>
        ${!bonus.used ? '<button>–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏</button>' : ''}
      `;

      if (!bonus.used) {
        const btn = card.querySelector("button");
        btn.addEventListener("click", () => {
          confirmModal.classList.add("active");
confirmModal.style.display = "flex";


          const closeModal = () => {
            confirmModal.classList.remove("active");
confirmModal.style.display = "none";

            confirmBtn.onclick = null;
            cancelBtn.onclick = null;
          };

          cancelBtn.onclick = closeModal;

          confirmBtn.onclick = async () => {
            const code = generateRandomCode();

            const codeRes = await fetch(`${supabaseUrl}/rest/v1/discount_codes`, {
              method: "POST",
              headers: {
                apikey: supabaseKey,
                Authorization: `Bearer ${supabaseKey}`,
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                user_id: userId,
                code,
                used: false,
                bonus_name: bonusData.title
              })
            });

            const updateRes = await fetch(`${supabaseUrl}/rest/v1/bonuses?id=eq.${bonus.id}`, {
              method: "PATCH",
              headers: {
                apikey: supabaseKey,
                Authorization: `Bearer ${supabaseKey}`,
                "Content-Type": "application/json"
              },
              body: JSON.stringify({ used: true })
            });

            closeModal();

            if (codeRes.ok && updateRes.ok) {
              alert(`üéâ –í–∞—à –∫–æ–¥: ${code}`);
              loadInventory();
            } else {
              alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –±–æ–Ω—É—Å—É.");
            }
          };
        });
      }

      inventoryListEl.appendChild(card);
    }
  }

  function setupMarketButtons() {
    const marketCards = document.querySelectorAll("#market-tab .bonus-card");
    marketCards.forEach((card, index) => {
      const btn = card.querySelector("button");
      btn.addEventListener("click", async () => {
        const bonus = availableBonuses[index];
        if (clicks < bonus.price) {
          alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–ª—ñ–∫—ñ–≤. –ü–æ—Ç—Ä—ñ–±–Ω–æ ${bonus.price}`);
          return;
        }

        clicks -= bonus.price;
        updateDisplay();
        await saveUserData();

        const res = await fetch(`${supabaseUrl}/rest/v1/bonuses`, {
          method: "POST",
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            user_id: userId,
            name: bonus.name,
            price: bonus.price,
            used: false
          })
        });

        if (res.ok) {
          alert(`üéÅ –í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –±–æ–Ω—É—Å: ${bonus.title}`);
          loadInventory();
        } else {
          alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –±–æ–Ω—É—Å—É.");
        }
      });
    });
  }

  
document.getElementById("tapBtn").addEventListener("click", (e) => {
Telegram.WebApp.HapticFeedback.impactOccurred('medium');


  const addAmount = isHappyHour ? 2 : 1;
  clicks += addAmount;
  updateDisplay();
  saveUserData();

  const plus = document.createElement("div");
  plus.className = "plus-one";
  plus.innerText = `+${addAmount}`;
  document.body.appendChild(plus);

  const rect = e.target.getBoundingClientRect();
  plus.style.left = rect.left + rect.width / 2 + "px";
  plus.style.top = rect.top + "px";

  setTimeout(() => {
    plus.remove();
  }, 800);
});


  function showTab(tabId, buttonEl) {
    document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
    document.getElementById(tabId).classList.add("active");
    document.querySelectorAll(".tab-button").forEach(btn => btn.classList.remove("active"));
    buttonEl.classList.add("active");
    if (tabId === "inventory-tab") loadInventory();
  }
const fortuneBtn = document.getElementById("fortuneBtn");
const fortuneModal = document.getElementById("fortuneModal");
const closeFortuneModal = document.getElementById("closeFortuneModal");

// –í—ñ–¥–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª–∫—É
fortuneBtn.addEventListener('click', () => {
  fortuneModal.style.display = 'flex';
  document.body.style.overflow = "hidden"; // –±–ª–æ–∫—É—î–º–æ –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Ñ–æ–Ω—É
});

// –ó–∞–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª–∫—É –∫–Ω–æ–ø–∫–æ—é
closeFortuneModal.addEventListener('click', () => {
  fortuneModal.style.display = 'none';
  document.body.style.overflow = ""; // –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø—Ä–æ–∫—Ä—É—Ç–∫—É
});

// –ó–∞–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª–∫—É –∫–ª—ñ–∫–æ–º –ø–æ —Ñ–æ–Ω—É
fortuneModal.addEventListener('click', e => {
  if (e.target === fortuneModal) {
    fortuneModal.style.display = 'none';
    document.body.style.overflow = "";
  }
});
/* ===== Mini Caf√© logic ===== */
const mcIngredientsEl = document.getElementById('mcIngredients');
const mcPlateEl = document.getElementById('mcPlate');
const mcMsgEl = document.getElementById('mcMsg');
const mcOrderEl = document.getElementById('mcOrder');
const mcResetBtn = document.getElementById('mcReset');

/** –ù–∞–±—ñ—Ä ¬´—Ä–µ—Ü–µ–ø—Ç—ñ–≤¬ª ‚Äî –º–æ–∂–Ω–∞ —Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏ */
const RECIPES = [
  {
    id: 'gyros',
    title: '–ì—ñ—Ä–æ—Å –∫–ª–∞—Å–∏—á–Ω–∏–π',
    rewardClicks: 50,
    steps: ['–ª–∞–≤–∞—à','–º º—è—Å–æ','–æ–≤–æ—á—ñ','—Å–æ—É—Å'],
  },
  {
    id: 'cheddarPita',
    title: '–ü—ñ—Ç–∞ –∑ —á–µ–¥–µ—Ä–æ–º',
    rewardClicks: 65,
    steps: ['–ø—ñ—Ç–∞','—Å–∏—Ä —á–µ–¥–µ—Ä','–æ–≤–æ—á—ñ','—Å–æ—É—Å'],
  }
];

/** –ü—É–ª —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º–∏ —ñ–∫–æ–Ω–∫–∞–º–∏ */
const ALL_ING = [
  { key:'–ª–∞–≤–∞—à', label:'–õ–∞–≤–∞—à', img:'lavash.png' },
  { key:'–º º—è—Å–æ', label:'–ú º—è—Å–æ', img:'meat.png' },
  { key:'–æ–≤–æ—á—ñ', label:'–û–≤–æ—á—ñ', img:'veggies.png' },
  { key:'—Å–æ—É—Å', label:'–°–æ—É—Å', img:'sauce.png' },
  { key:'–ø—ñ—Ç–∞', label:'–ü—ñ—Ç–∞', img:'pita.png' },
  { key:'—Å–∏—Ä —á–µ–¥–µ—Ä', label:'–ß–µ–¥–µ—Ä', img:'cheddar.png' },
];

let currentRecipe = null;
let progress = 0;

function pickRecipe() {
  // –æ–±–µ—Ä–µ–º–æ –≤–∏–ø–∞–¥–∫–æ–≤–∏–π —Ä–µ—Ü–µ–ø—Ç –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ
  currentRecipe = RECIPES[Math.floor(Math.random()*RECIPES.length)];
  mcOrderEl.textContent = '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è: ' + currentRecipe.title;
  progress = 0;
  mcMsgEl.innerHTML = '';
  renderIngredients();
  mcPlateEl.innerHTML = '';
}

function renderIngredients() {
  mcIngredientsEl.innerHTML = '';
  const poolKeys = new Set([...currentRecipe.steps]); // –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ + –ø–∞—Ä—É –∑–∞–π–≤–∏—Ö, —â–æ–± –±—É–ª–æ —Ü—ñ–∫–∞–≤—ñ—à–µ
  // –¥–æ–¥–∞–º–æ 2 –±—É–¥—å-—è–∫—ñ –∑–∞–π–≤—ñ
  while (poolKeys.size < currentRecipe.steps.length + 2) {
    const extra = ALL_ING[Math.floor(Math.random()*ALL_ING.length)].key;
    poolKeys.add(extra);
  }

  // –∑—ñ–±—Ä–∞—Ç–∏ –æ–± º—î–∫—Ç–∏ —ñ —Ç—Ä–æ—Ö–∏ –ø–µ—Ä–µ–º—ñ—à–∞—Ç–∏
  const items = Array.from(poolKeys).map(k => ALL_ING.find(i => i.key===k)).filter(Boolean);
  items.sort(()=>Math.random()-.5);

  for (const ing of items) {
    const btn = document.createElement('button');
    btn.className = 'ingredient';
    btn.dataset.key = ing.key;
    btn.innerHTML = `<img src="${ing.img}" alt="${ing.label}"><div>${ing.label}</div>`;
    btn.addEventListener('click', () => onIngredientClick(btn, ing));
    mcIngredientsEl.appendChild(btn);
  }
}

function onIngredientClick(btn, ing) {
  const needed = currentRecipe.steps[progress];
  if (ing.key === needed) {
    btn.classList.add('used');
    flyToPlate(btn, ing);
    progress++;
    mcMsgEl.innerHTML = `<div class="success-msg">–î–æ–±—Ä–µ! ${progress}/${currentRecipe.steps.length}</div>`;
    Telegram.WebApp.HapticFeedback.impactOccurred('light');

    if (progress === currentRecipe.steps.length) {
      onRecipeComplete();
    }
  } else {
    mcMsgEl.innerHTML = `<div class="err-msg">–ü–æ—Å–ø—ñ—à–∏–≤ üòÖ. –°–ø–æ—á–∞—Ç–∫—É: <b>${needed}</b></div>`;
    Telegram.WebApp.HapticFeedback.notificationOccurred('warning');
  }
}

function flyToPlate(btn, ing) {
  const rect = btn.getBoundingClientRect();
  const plateRect = mcPlateEl.getBoundingClientRect();

  const ghost = document.createElement('img');
  ghost.src = ALL_ING.find(i=>i.key===ing.key)?.img || '';
  ghost.className = 'fly';
  ghost.style.left = rect.left + 'px';
  ghost.style.top  = rect.top + 'px';
  document.body.appendChild(ghost);

  requestAnimationFrame(() => {
    const dx = plateRect.left + plateRect.width/2 - rect.left - 24;
    const dy = plateRect.top + plateRect.height/2 - rect.top  - 24;
    ghost.style.transform = `translate(${dx}px, ${dy}px) scale(.6)`;
    ghost.style.opacity = '0.1';
  });

  setTimeout(() => {
    ghost.remove();
    const chip = document.createElement('img');
    chip.src = ALL_ING.find(i=>i.key===ing.key)?.img || '';
    chip.style.width = '36px';
    chip.style.height = '36px';
    chip.style.borderRadius = '8px';
    mcPlateEl.appendChild(chip);
  }, 460);
}

async function onRecipeComplete() {
  const reward = currentRecipe.rewardClicks;
  clicks += reward;
  updateDisplay();
  await saveUserData();

  mcMsgEl.innerHTML = `<div class="success-msg">üéâ –ì–æ—Ç–æ–≤–æ! +${reward} –∫–ª—ñ–∫—ñ–≤ –∑–∞ ¬´${currentRecipe.title}¬ª</div>`;
  Telegram.WebApp.HapticFeedback.notificationOccurred('success');
}

mcResetBtn.addEventListener('click', () => {
  pickRecipe();
});
const mcCloseBtn = document.getElementById('mcClose');
mcCloseBtn.addEventListener('click', () => {
  fortuneModal.style.display = 'none';
  document.body.style.overflow = "";
});
/** –ö–æ–ª–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è —Ç–≤–æ—è –º–æ–¥–∞–ª–∫–∞ ‚Äî —Å—Ç–∞—Ä—Ç—É—î–º–æ –≥—Ä—É */
fortuneBtn.addEventListener('click', () => {
  pickRecipe();
});

  fetchUserData().then(() => {
    setupMarketButtons();
    loadInventory();
  });
</script>


</body>
</html>

  






































