<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Greek House Tapper</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
        :root {
      --main-green: #0f0;
      --accent-green: #00ffaa;
      --dark-bg: #050505;
      --panel-bg: rgba(0, 255, 150, 0.1);
      --card-bg: rgba(0, 255, 150, 0.05);
      --neon-glow: 0 0 8px #0f0, 0 0 16px #0f0, 0 0 32px #0f0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Orbitron', sans-serif;
      margin: 0;
      padding: 0;
      background: var(--dark-bg);
      color: #0f0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .tab-content {
      flex: 1;
      padding: 20px;
      display: none;
      overflow-y: auto;
      animation: fadeIn 0.4s ease-in;
    }

    .tab-content.active {
      display: block;
    }

    .tab-bar {
      display: flex;
      height: 60px;
      background: var(--panel-bg);
      border-top: 1px solid #0f0;
      box-shadow: inset 0 1px 2px #0f0;
      position: sticky;
      bottom: 0;
    }

    .tab-button {
      flex: 1;
      padding: 10px;
      cursor: pointer;
      border: none;
      background: none;
      color: #0f0;
      text-shadow: var(--neon-glow);
      font-size: 18px;
      transition: all 0.3s;
    }

    .tab-button.active {
      background: var(--accent-green);
      color: black;
      font-weight: bold;
      box-shadow: inset 0 0 12px #00ffaa;
    }

    .tap-button {
      font-size: 24px;
      padding: 18px 36px;
      margin-top: 30px;
      background: linear-gradient(to right, #00ffaa, #0f0);
      border: none;
      border-radius: 14px;
      color: black;
      text-transform: uppercase;
      text-shadow: 1px 1px 2px #000;
      box-shadow: 0 0 12px #0f0, inset 0 0 8px #0f0;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }

    .tap-button:hover {
      transform: scale(1.05);
      background: linear-gradient(to right, #0f0, #00ffaa);
    }

    .counter {
      margin-top: 20px;
      font-size: 28px;
      text-shadow: var(--neon-glow);
    }

    .bonus-list {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .bonus-card {
      background: var(--card-bg);
      border: 1px solid #0f0;
      border-radius: 16px;
      padding: 16px;
      box-shadow: var(--neon-glow);
      backdrop-filter: blur(6px);
      transition: transform 0.3s ease;
    }

    .bonus-card:hover {
      transform: scale(1.03);
    }

    .bonus-title {
      font-size: 20px;
      margin-bottom: 8px;
      text-shadow: var(--neon-glow);
    }

    .bonus-description {
      font-size: 16px;
      margin-bottom: 10px;
      color: #aaa;
    }

    .bonus-price {
      font-size: 18px;
      margin-bottom: 10px;
      color: #0f0;
    }

    .bonus-card button {
      padding: 12px 18px;
      background: #0f0;
      color: #000;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      box-shadow: var(--neon-glow);
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    .bonus-card button:hover {
      background: #00ffaa;
      transform: scale(1.02);
    }

    .logo, .gyros-img, .bonus-card img {
      width: 100%;
      border-radius: 12px;
      box-shadow: 0 0 12px #0f0;
    }

    #confirmModal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 255, 0, 0.05);
      backdrop-filter: blur(4px);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    #confirmModal .modal-box {
      background: black;
      color: #0f0;
      padding: 24px;
      border: 1px solid #0f0;
      border-radius: 16px;
      box-shadow: var(--neon-glow);
      text-align: center;
      max-width: 80%;
    }

    #confirmModal button {
      margin: 8px;
      padding: 10px 20px;
      background: #0f0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      color: black;
      box-shadow: var(--neon-glow);
    }
  </style>
</head>
<body>

  <!-- –¢–∞–ø–∞—Ç–∏ -->
  <div id="tap-tab" class="tab-content active">
    <img src="logo.jfif" alt="Greek House logo" class="logo">
    <h2>–ü—Ä–∏–≤—ñ—Ç, <span id="username">...</span>!</h2>
    <button class="tap-button" id="tapBtn">–¢–ê–ü–ê–ô –ì–Ü–†–û–° üçó</button>
    <div class="counter" id="counter">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    <img src="bg.jpg" alt="Gyros" class="gyros-img">
  </div>

 <!-- –†–∏–Ω–æ–∫ -->
<div id="market-tab" class="tab-content">
  <h2>üõí –†–∏–Ω–æ–∫ –±–æ–Ω—É—Å—ñ–≤</h2>
  <div class="bonus-list">
    <div class="bonus-card">
      <img src="gyros.jpeg" alt="–ó–Ω–∏–∂–∫–∞ –Ω–∞ –≥—ñ—Ä–æ—Å">
      <div class="bonus-title">-50% –Ω–∞ –≥—ñ—Ä–æ—Å</div>
      <div class="bonus-description">–°–º–∞—á–Ω–∞ –∑–Ω–∏–∂–∫–∞ –Ω–∞ –≥—ñ—Ä–æ—Å —É Greek House</div>
      <div class="bonus-price">1000 –∫–ª—ñ–∫—ñ–≤</div>
      <button>–û—Ç—Ä–∏–º–∞—Ç–∏</button>
    </div>

    <div class="bonus-card">
      <img src="kartoplafrivelyka.jpeg" alt="–í–µ–ª–∏–∫–∞ –∫–∞—Ä—Ç–æ–ø–ª—è –∑–∞ 35 –≥—Ä–Ω">
      <div class="bonus-title">–í–µ–ª–∏–∫–∞ –∫–∞—Ä—Ç–æ–ø–ª—è –∑–∞ 35 –≥—Ä–Ω</div>
      <div class="bonus-description">–û–±–º—ñ–Ω—è–π –∫–ª—ñ–∫–∏ –Ω–∞ —Ö—Ä—É—Å—Ç–∫—É –∫–∞—Ä—Ç–æ–ø–ª—é!</div>
      <div class="bonus-price">700 –∫–ª—ñ–∫—ñ–≤</div>
      <button>–û—Ç—Ä–∏–º–∞—Ç–∏</button>
    </div>

    <div class="bonus-card">
      <img src="pitagrylichederini.png" alt="–ó–Ω–∏–∂–∫–∞ –Ω–∞ –ø—ñ—Ç—É –≥—Ä–∏–ª—å –∑ —á–µ–¥–µ—Ä–æ–º">
      <div class="bonus-title">-50% –Ω–∞ –ø—ñ—Ç—É –≥—Ä–∏–ª—å –∑ —á–µ–¥–µ—Ä–æ–º</div>
      <div class="bonus-description">–°–∫—É—à—Ç—É–π —É–ª—é–±–ª–µ–Ω—É –ø—ñ—Ç—É –≤ 2 —Ä–∞–∑–∏ –¥–µ—à–µ–≤—à–µ!</div>
      <div class="bonus-price">750 –∫–ª—ñ–∫—ñ–≤</div>
      <button>–û—Ç—Ä–∏–º–∞—Ç–∏</button>
    </div>
  </div>
</div>


  <!-- –Ü–Ω–≤–µ–Ω—Ç–∞—Ä -->
  <div id="inventory-tab" class="tab-content">
    <h2>üéí –Ü–Ω–≤–µ–Ω—Ç–∞—Ä</h2>
    <div class="bonus-list"></div>
  </div>

  <!-- –ü–∞–Ω–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ -->
  <div class="tab-bar">
    <button class="tab-button active" onclick="showTab('tap-tab', this)">–¢–∞–ø–∞—Ç–∏</button>
    <button class="tab-button" onclick="showTab('market-tab', this)">–†–∏–Ω–æ–∫</button>
    <button class="tab-button" onclick="showTab('inventory-tab', this)">–Ü–Ω–≤–µ–Ω—Ç–∞—Ä</button>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ -->
  <div id="confirmModal">
    <div class="modal-box">
      <p>–ü—ñ—Å–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —Ü—å–æ–≥–æ –±–æ–Ω—É—Å—É –∑ º—è–≤–∏—Ç—å—Å—è –∫–æ–¥. –¶–µ–π –∫–æ–¥ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –∑–∞—Å–∫—Ä—ñ–Ω–∏—Ç–∏ –∞–±–æ –≤—ñ–¥—Ä–∞–∑—É –ø–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞ –∫–∞—Å—ñ. –Ü–Ω–∞–∫—à–µ, –≤–∏ –≤—Ç—Ä–∞—Ç–∏—Ç–µ —Ü–µ–π –∫–æ–¥ –Ω–∞–∑–∞–≤–∂–¥–∏.</p>
      <button id="confirmActivate">–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏</button>
      <button id="cancelActivate">–ù–∞–∑–∞–¥</button>
    </div>
  </div>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  const supabaseUrl = 'https://mftgqxilushpzewpqkvi.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1mdGdxeGlsdXNocHpld3Bxa3ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzMDQxMzMsImV4cCI6MjA2Njg4MDEzM30.qRsUDDHSFuP6hIQZwv0mVsfS-ZZDPPbDU5Zl55Hoezw';

  let user = tg.initDataUnsafe?.user || { id: 123456789, first_name: "–¢–µ—Å—Ç" };
  const userId = user.id;
  const userName = user.first_name || "–ì—ñ—Å—Ç—å";
  document.getElementById("username").innerText = userName;

  const counterEl = document.getElementById("counter");
  const inventoryListEl = document.querySelector("#inventory-tab .bonus-list");

  const confirmModal = document.getElementById("confirmModal");
  const confirmBtn = document.getElementById("confirmActivate");
  const cancelBtn = document.getElementById("cancelActivate");

  const availableBonuses = [
    {
      name: "gyros",
      title: "-50% –Ω–∞ –≥—ñ—Ä–æ—Å",
      description: "–°–º–∞—á–Ω–∞ –∑–Ω–∏–∂–∫–∞ –Ω–∞ –≥—ñ—Ä–æ—Å —É Greek House",
      price: 1000,
      image: "gyros.jpeg"
    },
    {
      name: "bigPotato",
      title: "–í–µ–ª–∏–∫–∞ –∫–∞—Ä—Ç–æ–ø–ª—è –∑–∞ 35 –≥—Ä–Ω",
      description: "–û–±–º—ñ–Ω—è–π –∫–ª—ñ–∫–∏ –Ω–∞ —Ö—Ä—É—Å—Ç–∫—É –∫–∞—Ä—Ç–æ–ø–ª—é!",
      price: 700,
      image: "kartoplafrivelyka.jpeg"
    },
    {
      name: "pitaGrylZChederom",
      title: "-50% –Ω–∞ –ø—ñ—Ç—É –≥—Ä–∏–ª—å –∑ —á–µ–¥–µ—Ä–æ–º",
      description: "–°–∫—É—à—Ç—É–π —É–ª—é–±–ª–µ–Ω—É –ø—ñ—Ç—É –≤ 2 —Ä–∞–∑–∏ –¥–µ—à–µ–≤—à–µ!",
      price: 750,
      image: "pitagrylichederini.png"
    }
  ];

  let clicks = 0;

  async function fetchUserData() {
    const res = await fetch(`${supabaseUrl}/rest/v1/clicks?user_id=eq.${userId}`, {
      headers: { apikey: supabaseKey, Authorization: `Bearer ${supabaseKey}` }
    });
    const data = await res.json();
    if (data.length > 0) clicks = data[0].clicks;
    else {
      await fetch(`${supabaseUrl}/rest/v1/clicks`, {
        method: "POST",
        headers: { apikey: supabaseKey, Authorization: `Bearer ${supabaseKey}`, "Content-Type": "application/json" },
        body: JSON.stringify({ user_id: userId, clicks: 0 })
      });
    }
    updateDisplay();
  }

  function updateDisplay() {
    counterEl.innerText = `–ö–ª—ñ–∫—ñ–≤: ${clicks}`;
  }

  async function saveUserData() {
    await fetch(`${supabaseUrl}/rest/v1/clicks?user_id=eq.${userId}`, {
      method: "PATCH",
      headers: { apikey: supabaseKey, Authorization: `Bearer ${supabaseKey}`, "Content-Type": "application/json" },
      body: JSON.stringify({ clicks })
    });
  }

  function generateRandomCode() {
    const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let code = 'GH-';
    for (let i = 0; i < 5; i++) code += charset[Math.floor(Math.random() * charset.length)];
    return code;
  }

  async function loadInventory() {
    const res = await fetch(`${supabaseUrl}/rest/v1/bonuses?user_id=eq.${userId}`, {
      headers: { apikey: supabaseKey, Authorization: `Bearer ${supabaseKey}` }
    });
    const bonuses = await res.json();
    inventoryListEl.innerHTML = "";
    bonuses.sort((a, b) => a.used - b.used);

    for (const bonus of bonuses) {
      const bonusData = availableBonuses.find(b => b.name === bonus.name);
      if (!bonusData) continue;

      const card = document.createElement("div");
      card.className = "bonus-card";
      if (bonus.used) card.classList.add("used");

      card.innerHTML = `
        <img src="${bonusData.image}" alt="${bonusData.title}">
        <div class="bonus-title">${bonusData.title}</div>
        <div class="bonus-description">${bonusData.description}</div>
        <div class="bonus-price">–°—Ç–∞—Ç—É—Å: <strong>${bonus.used ? "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ" : "–ì–æ—Ç–æ–≤–∏–π –¥–æ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó"}</strong></div>
        ${!bonus.used ? '<button>–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏</button>' : ''}
      `;

      if (!bonus.used) {
        const btn = card.querySelector("button");
        btn.addEventListener("click", () => {
          confirmModal.style.display = "flex";

          const closeModal = () => {
            confirmModal.style.display = "none";
            confirmBtn.onclick = null;
            cancelBtn.onclick = null;
          };

          cancelBtn.onclick = closeModal;

          confirmBtn.onclick = async () => {
            const code = generateRandomCode();

            const codeRes = await fetch(`${supabaseUrl}/rest/v1/discount_codes`, {
              method: "POST",
              headers: { apikey: supabaseKey, Authorization: `Bearer ${supabaseKey}`, "Content-Type": "application/json" },
              body: JSON.stringify({ user_id: userId, code, used: false, bonus_name: bonusData.title})
            });

            const updateRes = await fetch(`${supabaseUrl}/rest/v1/bonuses?id=eq.${bonus.id}`, {
              method: "PATCH",
              headers: { apikey: supabaseKey, Authorization: `Bearer ${supabaseKey}`, "Content-Type": "application/json" },
              body: JSON.stringify({ used: true })
            });

            closeModal();

            if (codeRes.ok && updateRes.ok) {
              alert(`üéâ –í–∞—à –∫–æ–¥: ${code}`);
              loadInventory();
            } else {
              alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –±–æ–Ω—É—Å—É.");
            }
          };
        });
      }

      inventoryListEl.appendChild(card);
    }
  }

  function setupMarketButtons() {
    const marketCards = document.querySelectorAll("#market-tab .bonus-card");
    marketCards.forEach((card, index) => {
      const btn = card.querySelector("button");
      btn.addEventListener("click", async () => {
        const bonus = availableBonuses[index];
        if (clicks < bonus.price) {
          alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–ª—ñ–∫—ñ–≤. –ü–æ—Ç—Ä—ñ–±–Ω–æ ${bonus.price}`);
          return;
        }

        clicks -= bonus.price;
        updateDisplay();
        await saveUserData();

        const res = await fetch(`${supabaseUrl}/rest/v1/bonuses`, {
          method: "POST",
          headers: { apikey: supabaseKey, Authorization: `Bearer ${supabaseKey}`, "Content-Type": "application/json" },
          body: JSON.stringify({ user_id: userId, name: bonus.name, price: bonus.price, used: false })
        });

        if (res.ok) {
          alert(`üéÅ –í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –±–æ–Ω—É—Å: ${bonus.title}`);
          loadInventory();
        } else {
          alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –±–æ–Ω—É—Å—É.");
        }
      });
    });
  }

  document.getElementById("tapBtn").addEventListener("click", () => {
    clicks++;
    updateDisplay();
    saveUserData();
  });

  function showTab(tabId, buttonEl) {
    document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
    document.getElementById(tabId).classList.add("active");
    document.querySelectorAll(".tab-button").forEach(btn => btn.classList.remove("active"));
    buttonEl.classList.add("active");
    if (tabId === "inventory-tab") loadInventory();
  }

  fetchUserData().then(() => {
    setupMarketButtons();
    loadInventory();
  });
</script>

</body>
</html>


  
