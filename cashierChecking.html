<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞—Å–∏—Ä | –ó–Ω–∏–∂–∫–æ–≤–∏–π –∫–æ–¥</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 40px 20px;
      background-color: #fffefc;
      text-align: center;
    }
    h1 {
      color: #222;
    }
    input {
      padding: 12px;
      font-size: 18px;
      width: 80%;
      max-width: 300px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 20px;
    }
    button {
      padding: 12px 20px;
      font-size: 18px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .result {
      margin-top: 20px;
      font-size: 20px;
    }
    #pinSection {
      margin-bottom: 40px;
    }
  </style>
</head>
<body>
  <h1>üîê –î–æ—Å—Ç—É–ø –∫–∞—Å–∏—Ä–∞</h1>

  <div id="pinSection">
    <input type="password" id="pinInput" placeholder="–í–≤–µ–¥—ñ—Ç—å PIN" />
    <br>
    <button onclick="checkPin()">–£–≤—ñ–π—Ç–∏</button>
    <div class="result" id="pinResult"></div>
  </div>

  <div id="appSection" style="display: none;">
    <h2>–°–ø–∏—Å–∞–Ω–Ω—è –∑–Ω–∏–∂–∫–∏</h2>
    <input type="text" id="codeInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ (GH-...)" />
    <br>
    <button onclick="checkCode()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
    <div class="result" id="result"></div>
  </div>

  <script>
    const supabaseUrl = 'https://mftgqxilushpzewpqkvi.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'; // ‚Üê –≤—Å—Ç–∞–≤ —Å—é–¥–∏ —Å–≤—ñ–π –∫–ª—é—á

    const CORRECT_PIN = '9548';

    function checkPin() {
      const pin = document.getElementById('pinInput').value.trim();
      const pinResult = document.getElementById('pinResult');

      if (pin === CORRECT_PIN) {
        document.getElementById('pinSection').style.display = 'none';
        document.getElementById('appSection').style.display = 'block';
      } else {
        pinResult.innerText = "‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π PIN-–∫–æ–¥.";
      }
    }

    async function checkCode() {
      const code = document.getElementById('codeInput').value.trim().toUpperCase();
      const resultEl = document.getElementById('result');

      if (!code) {
        resultEl.innerText = "‚ùóÔ∏è –í–≤–µ–¥—ñ—Ç—å –∫–æ–¥.";
        return;
      }

      const res = await fetch(`${supabaseUrl}/rest/v1/discount_codes?code=eq.${code}`, {
        headers: {
          apikey: supabaseKey,
          Authorization: `Bearer ${supabaseKey}`
        }
      });

      const data = await res.json();

      if (!data.length || data[0].used) {
        resultEl.innerText = "‚ùå –ö–æ–¥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–±–æ –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ.";
        return;
      }

      const patch = await fetch(`${supabaseUrl}/rest/v1/discount_codes?code=eq.${code}`, {
        method: "PATCH",
        headers: {
          apikey: supabaseKey,
          Authorization: `Bearer ${supabaseKey}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ used: true })
      });

      if (patch.ok) {
        resultEl.innerText = "‚úÖ –ó–Ω–∏–∂–∫—É –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ!";
      } else {
        resultEl.innerText = "‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–Ω—ñ –∫–æ–¥—É.";
      }
    }
  </script>
</body>
</html>

